/**
 * Accessibility Utilities
 * Part of CSS Refactor Phase 4.2
 * 
 * WCAG AAA Compliant utilities for:
 * - Focus management
 * - Screen reader support
 * - High contrast mode
 * - Reduced motion
 * - Color contrast
 * - Keyboard navigation
 */

@layer utilities {
	/* ==========================================================================
	   SCREEN READER UTILITIES
	   ========================================================================== */

	/**
	 * Visually Hidden (Screen Reader Only)
	 * Hides content visually but keeps it accessible to screen readers
	 * Use for: Skip links, form labels, descriptive text
	 */
	.sr-only,
	.visually-hidden {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}

	/**
	 * Screen Reader Only - Focusable
	 * Hidden until focused (for skip links)
	 */
	.sr-only-focusable:not(:focus):not(:focus-within),
	.visually-hidden-focusable:not(:focus):not(:focus-within) {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}

	/**
	 * Show when focused (for skip links)
	 */
	.sr-only-focusable:focus,
	.sr-only-focusable:focus-within,
	.visually-hidden-focusable:focus,
	.visually-hidden-focusable:focus-within {
		position: static;
		width: auto;
		height: auto;
		padding: var(--spacing-2) var(--spacing-4);
		margin: 0;
		overflow: visible;
		clip: auto;
		white-space: normal;
		/* Enhanced styling for skip links */
		background: var(--color-primary);
		color: var(--color-white);
		border-radius: var(--radius-md);
		z-index: 9999;
		outline: 3px solid var(--color-primary-dark);
		outline-offset: 2px;
	}

	/**
	 * Screen Reader Text
	 * Alternative to .sr-only with better naming
	 */
	.sr-text,
	.screen-reader-text {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}

	/* ==========================================================================
	   ENHANCED FOCUS INDICATORS
	   WCAG 2.4.7 (AAA) - Visible focus indicators
	   ========================================================================== */

	/**
	 * Enhanced Focus Ring
	 * High contrast, always visible focus indicator
	 */
	.focus-ring:focus,
	.focus-ring:focus-visible {
		outline: 3px solid var(--color-primary);
		outline-offset: 3px;
		border-radius: var(--radius-sm);
	}

	/**
	 * Focus Ring - Inset
	 * For buttons and filled elements
	 */
	.focus-ring-inset:focus,
	.focus-ring-inset:focus-visible {
		outline: 3px solid var(--color-primary);
		outline-offset: -3px;
		border-radius: var(--radius-sm);
	}

	/**
	 * Focus Ring - Strong
	 * Extra visible for important actions
	 */
	.focus-ring-strong:focus,
	.focus-ring-strong:focus-visible {
		outline: 4px solid var(--color-primary);
		outline-offset: 4px;
		box-shadow: 0 0 0 4px rgba(var(--color-primary-rgb), 0.2);
	}

	/**
	 * Focus Ring - Accessible
	 * High contrast variant for accessibility
	 */
	.focus-ring-accessible:focus,
	.focus-ring-accessible:focus-visible {
		outline: 3px solid currentColor;
		outline-offset: 3px;
	}

	/**
	 * Skip Link
	 * Visible skip navigation link
	 */
	.skip-link {
		position: absolute;
		top: var(--spacing-2);
		left: var(--spacing-2);
		z-index: 9999;
		padding: var(--spacing-2) var(--spacing-4);
		background: var(--color-primary);
		color: var(--color-white);
		text-decoration: none;
		border-radius: var(--radius-md);
		font-weight: var(--font-weight-semibold);
		/* Hidden until focused */
		transform: translateY(-120%);
		transition: transform var(--motion-duration-fast) var(--motion-ease-out);
	}

	.skip-link:focus {
		transform: translateY(0);
		outline: 3px solid var(--color-primary-dark);
		outline-offset: 3px;
	}

	/* ==========================================================================
	   HIGH CONTRAST MODE SUPPORT
	   Ensures visibility in Windows High Contrast Mode
	   ========================================================================== */

	@media (prefers-contrast: high) {
		/**
		 * Enhanced borders for high contrast
		 */
		.high-contrast-border {
			border: 2px solid currentColor;
		}

		/**
		 * Stronger focus indicators
		 */
		*:focus,
		*:focus-visible {
			outline: 3px solid currentColor;
			outline-offset: 3px;
		}

		/**
		 * Ensure buttons are visible
		 */
		button,
		[role='button'],
		[data-button] {
			border: 2px solid currentColor;
		}

		/**
		 * Ensure links are underlined
		 */
		a {
			text-decoration: underline;
			text-decoration-thickness: 2px;
		}

		/**
		 * Stronger shadows
		 */
		.card,
		[data-card],
		.panel {
			border: 2px solid currentColor;
		}
	}

	/* ==========================================================================
	   COLOR CONTRAST UTILITIES
	   WCAG AAA compliant (7:1 ratio)
	   ========================================================================== */

	/**
	 * High Contrast Text
	 * Ensures text meets AAA standards
	 */
	.text-high-contrast {
		color: var(--color-text-default);
		font-weight: var(--font-weight-medium);
	}

	/**
	 * High Contrast Link
	 * Enhanced link visibility
	 */
	.link-high-contrast {
		color: var(--color-primary-dark);
		text-decoration: underline;
		text-decoration-thickness: 2px;
		text-underline-offset: 2px;
	}

	.link-high-contrast:hover {
		color: var(--color-primary);
		text-decoration-thickness: 3px;
	}

	/**
	 * High Contrast Background
	 */
	.bg-high-contrast {
		background: var(--color-white);
		color: var(--color-black);
	}

	:global(html.dark) .bg-high-contrast {
		background: var(--color-black);
		color: var(--color-white);
	}

	/* ==========================================================================
	   KEYBOARD NAVIGATION UTILITIES
	   ========================================================================== */

	/**
	 * Keyboard Only Focus
	 * Shows focus only for keyboard navigation
	 */
	.focus-visible-only:focus:not(:focus-visible) {
		outline: none;
	}

	.focus-visible-only:focus-visible {
		outline: 3px solid var(--color-primary);
		outline-offset: 3px;
	}

	/**
	 * Tab Index Helper
	 * Makes non-interactive elements keyboard accessible
	 */
	.keyboard-accessible {
		cursor: pointer;
	}

	.keyboard-accessible:focus-visible {
		outline: 3px solid var(--color-primary);
		outline-offset: 2px;
	}

	/* ==========================================================================
	   MOTION PREFERENCES
	   Respects user's motion preferences
	   ========================================================================== */

	/**
	 * Safe Animation
	 * Only animates when user allows motion
	 */
	@media (--prefers-motion) {
		.safe-animate {
			transition: all var(--motion-duration-base) var(--motion-ease-base);
		}
	}

	@media (--prefers-reduced-motion) {
		.safe-animate {
			transition: none;
		}
	}

	/**
	 * Safe Transform
	 * Only transforms when user allows motion
	 */
	@media (--prefers-motion) {
		.safe-transform {
			transition: transform var(--motion-duration-base) var(--motion-ease-base);
		}
	}

	@media (--prefers-reduced-motion) {
		.safe-transform {
			transition: none;
			transform: none !important;
		}
	}

	/* ==========================================================================
	   ARIA UTILITIES
	   Visual indicators for ARIA states
	   ========================================================================== */

	/**
	 * ARIA Hidden
	 * Completely hidden from accessibility tree
	 */
	[aria-hidden='true'] {
		pointer-events: none;
	}

	/**
	 * ARIA Disabled
	 * Visual styling for disabled elements
	 */
	[aria-disabled='true'],
	[disabled] {
		opacity: 0.5;
		cursor: not-allowed;
		pointer-events: none;
	}

	/**
	 * ARIA Selected
	 */
	[aria-selected='true'] {
		background: var(--color-primary-light);
		color: var(--color-primary-dark);
		font-weight: var(--font-weight-semibold);
	}

	/**
	 * ARIA Expanded
	 * Visual indicator for expanded/collapsed state
	 */
	[aria-expanded='true']::after {
		/* Add visual indicator if needed in specific components */
		content: '';
	}

	[aria-expanded='false']::after {
		/* Add visual indicator if needed in specific components */
		content: '';
	}

	/**
	 * ARIA Pressed
	 */
	[aria-pressed='true'] {
		background: var(--color-primary);
		color: var(--color-white);
	}

	/**
	 * ARIA Live Regions
	 * Polite announcement regions
	 */
	[aria-live='polite'] {
		position: relative;
	}

	/* ==========================================================================
	   TOUCH TARGET UTILITIES
	   Ensures minimum 44x44px touch targets (WCAG 2.5.5)
	   ========================================================================== */

	/**
	 * Minimum Touch Target
	 * Ensures 44x44px minimum for iOS/Android guidelines
	 */
	.touch-target {
		min-width: 44px;
		min-height: 44px;
		display: inline-flex;
		align-items: center;
		justify-content: center;
	}

	/**
	 * Touch Target Large
	 * 48x48px for better usability
	 */
	.touch-target-lg {
		min-width: 48px;
		min-height: 48px;
		display: inline-flex;
		align-items: center;
		justify-content: center;
	}

	/**
	 * Touch Spacing
	 * Ensures adequate spacing between touch targets
	 */
	.touch-spacing {
		margin: var(--spacing-2);
	}

	/* ==========================================================================
	   PRINT ACCESSIBILITY
	   Ensures content is accessible in print
	   ========================================================================== */

	@media print {
		/**
		 * Show URLs for links
		 */
		.print-url a[href]::after {
			content: ' (' attr(href) ')';
			font-size: 0.875em;
			color: var(--color-text-muted);
		}

		/**
		 * Hide decorative elements
		 */
		.no-print,
		[aria-hidden='true'] {
			display: none !important;
		}

		/**
		 * Ensure good contrast
		 */
		* {
			color: black !important;
			background: white !important;
		}

		/**
		 * Show all content (no truncation)
		 */
		.sr-only,
		.visually-hidden {
			position: static;
			width: auto;
			height: auto;
			clip: auto;
		}
	}

	/* ==========================================================================
	   RESPONSIVE ACCESSIBILITY
	   ========================================================================== */

	/**
	 * Mobile: Larger touch targets
	 */
	@media (--mq-md-down) {
		.mobile\:touch-target {
			min-width: 48px;
			min-height: 48px;
		}

		/* Larger focus indicators on mobile */
		*:focus-visible {
			outline-width: 4px;
			outline-offset: 4px;
		}
	}

	/**
	 * Desktop: More subtle focus indicators
	 */
	@media (--mq-lg) {
		.lg\:focus-subtle:focus-visible {
			outline-width: 2px;
			outline-offset: 2px;
		}
	}
}

/* ==========================================================================
   USAGE NOTES
   ========================================================================== 

   Screen Reader Classes:
   - Use .sr-only for descriptive text
   - Use .sr-only-focusable for skip links
   - Always include screen reader text for icon-only buttons

   Focus Indicators:
   - Never use outline: none without providing alternative
   - Use :focus-visible for keyboard-only focus
   - Ensure 3px minimum outline width
   - Use contrasting colors (3:1 ratio minimum)

   High Contrast Mode:
   - Test in Windows High Contrast Mode
   - Use currentColor for borders and outlines
   - Ensure text-decoration on links
   - Add visible borders to interactive elements

   Touch Targets:
   - Minimum 44x44px for all interactive elements
   - Add adequate spacing between targets
   - Test on actual touch devices

   Color Contrast:
   - Text: 7:1 ratio for AAA (4.5:1 for AA)
   - Large text: 4.5:1 for AAA (3:1 for AA)
   - Use tools like WebAIM Contrast Checker
   - Test with color blindness simulators

   Motion Preferences:
   - Always provide reduced-motion alternatives
   - Use @media (prefers-reduced-motion: reduce)
   - Instant transitions instead of animations
   - Maintain functionality without motion

   ========================================================================== */
