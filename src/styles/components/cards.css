/**
 * Card Component System
 * 
 * Modern card architecture using data attributes and container queries.
 * 
 * Usage:
 *   <div data-card data-variant="primary" data-size="md" data-layout="vertical">
 * 
 * Data Attributes:
 *   - data-card: Base card marker
 *   - data-variant: "default" | "primary" | "secondary" | "accent" | "highlight" | "entity" | "glass"
 *   - data-size: "sm" | "md" | "lg"
 *   - data-layout: "vertical" | "horizontal"
 *   - data-interactive: Adds hover effects
 * 
 * Legacy Support:
 *   - .card class still supported for backward compatibility
 */

@layer components {
	/* ============================================
	   Base Card Styles
	   ============================================ */

	.card,
	[data-card] {
		/* Layout */
		display: flex;
		flex-direction: column;
		height: 100%;
		position: relative;
		overflow: hidden;
		
		/* Container Query Support */
		container-type: inline-size;
		container-name: card;
		
		/* Visual */
		border-radius: var(--border-radius-lg);
		border: var(--border-width-thin) solid
			rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-border-light));
		
		/* Glassmorphism */
		background: linear-gradient(
			135deg,
			rgba(var(--color-primary-rgb), 0.03) 0%,
			rgba(var(--color-highlight-rgb), 0.02) 50%,
			rgba(var(--color-accent-rgb), 0.01) 100%
		);
		-webkit-backdrop-filter: blur(var(--glass-blur-fallback));
		backdrop-filter: blur(var(--glass-blur-fallback));
		
		/* Shadow */
		box-shadow:
			0 var(--spacing-2) var(--spacing-8) 0 rgba(var(--card-shadow-color), var(--card-shadow-opacity)),
			inset 0 var(--border-width-thin) 0
				rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-inset-light));
		
		/* Transitions - use motion tokens */
		transition:
			transform var(--motion-duration-normal, var(--anim-duration-base)) var(--motion-ease-out, var(--anim-ease-out)),
			box-shadow var(--motion-duration-normal, var(--anim-duration-base)) var(--motion-ease-out, var(--anim-ease-out)),
			background var(--motion-duration-normal, var(--anim-duration-base)) var(--motion-ease-out, var(--anim-ease-out)),
			border-color var(--motion-duration-normal, var(--anim-duration-base)) var(--motion-ease-out, var(--anim-ease-out));
		
		/* Performance */
		contain: layout style;
	}

	/* ============================================
	   Interactive Card Hover States
	   ============================================ */

	.card:hover,
	.card[data-interactive]:hover,
	[data-card]:hover,
	[data-card][data-interactive]:hover {
		background: linear-gradient(
			135deg,
			rgba(var(--color-primary-rgb), 0.05) 0%,
			rgba(var(--color-highlight-rgb), 0.03) 50%,
			rgba(var(--color-accent-rgb), 0.02) 100%
		);
		border-color: rgba(
			var(--color-background-rgb, 255, 255, 255),
			var(--card-glass-border-light-hover)
		);
		transform: var(--card-transform-hover);
		box-shadow:
			0 var(--spacing-3) var(--spacing-10) 0
				rgba(var(--card-shadow-color), var(--card-shadow-opacity-hover)),
			inset 0 var(--border-width-thin) 0
				rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-inset-light-hover));
	}

	/* ============================================
	   Card Subcomponents
	   ============================================ */

	.card-image,
	[data-card] [data-card-image] {
		width: 100%;
		background-color: var(--color-background-muted);
		flex-shrink: 0;
		overflow: hidden;
		aspect-ratio: 3/2;
		position: relative;
	}

	.card-image img,
	[data-card] [data-card-image] img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
		transition: transform var(--motion-duration-normal, var(--anim-duration-base)) var(--motion-ease-out, var(--anim-ease-out));
	}

	.card:hover .card-image img,
	[data-card]:hover [data-card-image] img {
		transform: scale(1.05);
	}

	.card-body,
	[data-card] [data-card-body] {
		padding: var(--spacing-6);
		flex-grow: 1;
		display: flex;
		flex-direction: column;
	}

	.card-title,
	[data-card] [data-card-title] {
		font-size: var(--font-size-xl);
		font-weight: var(--font-weight-semibold);
		margin-bottom: var(--spacing-2);
		line-height: var(--line-height-snug);
		color: var(--color-text-emphasis);
	}

	.card-subtitle,
	[data-card] [data-card-subtitle] {
		font-size: var(--font-size-sm);
		color: var(--color-text-light);
		margin-bottom: var(--spacing-3);
		line-height: var(--line-height-relaxed);
	}

	.card-text,
	.card-description,
	[data-card] [data-card-text] {
		color: var(--color-text);
		margin-bottom: var(--spacing-4);
		flex-grow: 1;
		line-height: var(--line-height-relaxed);
	}

	.card-footer,
	[data-card] [data-card-footer] {
		padding: var(--spacing-4) var(--spacing-6);
		border-top: var(--border-width-thin) solid var(--color-border);
		background-color: var(--color-background-alt);
		margin-top: auto;
	}

	.card-action,
	[data-card] [data-card-action] {
		margin-top: auto;
		align-self: flex-start;
	}

	/* ============================================
	   Card Size Variants
	   ============================================ */

	/* Small cards - compact spacing */
	.card-compact,
	.card[data-size='sm'],
	[data-card][data-size='sm'] {
		& [data-card-body],
		& .card-body {
			padding: var(--spacing-4);
		}

		& [data-card-title],
		& .card-title {
			font-size: var(--font-size-lg);
		}
	}

	/* Medium cards - default, no additional styles needed */
	.card[data-size='md'],
	[data-card][data-size='md'] {
		/* Default styles already applied */
	}

	/* Large cards - generous spacing */
	.card[data-size='lg'],
	[data-card][data-size='lg'] {
		& [data-card-body],
		& .card-body {
			padding: var(--spacing-8);
		}

		& [data-card-title],
		& .card-title {
			font-size: var(--font-size-2xl);
			margin-bottom: var(--spacing-3);
		}
	}

	/* ============================================
	   Card Layout Variants
	   ============================================ */

	/* Horizontal layout using container queries */
	.card-horizontal,
	.card[data-layout='horizontal'],
	[data-card][data-layout='horizontal'] {
		flex-direction: column;
	}

	/* Switch to horizontal at container width >= 400px */
	@container card (min-width: 400px) {
		.card-horizontal,
		.card[data-layout='horizontal'],
		[data-card][data-layout='horizontal'] {
			flex-direction: row;

			& [data-card-image],
			& .card-image {
				width: 33%;
				height: auto;
			}

			& [data-card-body],
			& .card-body {
				flex: 1;
			}
		}
	}

	/* ============================================
	   Card Variant Styles
	   ============================================ */

	/* Primary variant */
	.card-primary,
	.card[data-variant='primary'],
	[data-card][data-variant='primary'] {
		background: linear-gradient(
			135deg,
			rgba(var(--color-primary-rgb), 0.1) 0%,
			rgba(var(--color-primary-rgb), 0.05) 100%
		);
		border-color: var(--color-primary);

		& [data-card-title],
		& .card-title {
			color: var(--color-primary);
		}
	}

	/* Secondary variant */
	.card-secondary,
	.card[data-variant='secondary'],
	[data-card][data-variant='secondary'] {
		background: linear-gradient(
			135deg,
			rgba(var(--color-secondary-rgb), 0.1) 0%,
			rgba(var(--color-secondary-rgb), 0.05) 100%
		);
		border-color: var(--color-secondary);
	}

	/* Accent variant */
	.card-accent,
	.card[data-variant='accent'],
	[data-card][data-variant='accent'] {
		background: linear-gradient(
			135deg,
			rgba(var(--color-accent-rgb), 0.1) 0%,
			rgba(var(--color-accent-rgb), 0.05) 100%
		);
		border-color: var(--color-accent);
	}

	/* Highlight variant */
	.card-highlight,
	.card[data-variant='highlight'],
	[data-card][data-variant='highlight'] {
		background: linear-gradient(
			135deg,
			rgba(var(--color-highlight-rgb), 0.1) 0%,
			rgba(var(--color-highlight-rgb), 0.05) 100%
		);
		border-color: var(--color-highlight);
	}

	/* Entity variant (for publications, communications, etc.) */
	.entity-card,
	.card[data-variant='entity'],
	[data-card][data-variant='entity'] {
		padding: var(--spacing-4);
		background: linear-gradient(
			135deg,
			rgba(var(--color-primary-rgb), 0.03) 0%,
			rgba(var(--color-highlight-rgb), 0.02) 50%,
			rgba(var(--color-accent-rgb), 0.01) 100%
		);
	}

	.entity-card:hover,
	.card[data-variant='entity']:hover,
	[data-card][data-variant='entity']:hover {
		transform: var(--transform-lift-sm, translateY(-2px));
		background: linear-gradient(
			135deg,
			rgba(var(--color-primary-rgb), 0.05) 0%,
			rgba(var(--color-highlight-rgb), 0.03) 50%,
			rgba(var(--color-accent-rgb), 0.02) 100%
		);
	}

	/* Glass variant - enhanced transparency */
	.card[data-variant='glass'],
	[data-card][data-variant='glass'] {
		background: rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-opacity-light));
		border: var(--border-width-thin) solid
			rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-border-light));
	}

	/* ============================================
	   Card Visual Modifiers
	   ============================================ */

	.card-bordered,
	.card[data-bordered],
	[data-card][data-bordered] {
		border-width: var(--border-width-base);
	}

	.card-shadow,
	[data-card][data-shadow] {
		box-shadow: var(--shadow);
	}

	.card-shadow-lg,
	[data-card][data-shadow='lg'] {
		box-shadow: var(--shadow-lg);
	}

	/* ============================================
	   Card Utilities
	   ============================================ */

	/* Visual indicator for linked cards */
	.card-link::after {
		content: 'â†’';
		position: absolute;
		bottom: var(--spacing-4);
		right: var(--spacing-4);
		opacity: 0;
		transition:
			opacity var(--motion-duration-fast, var(--anim-duration-fast)) var(--motion-ease-out, var(--anim-ease-out)),
			transform var(--motion-duration-fast, var(--anim-duration-fast)) var(--motion-ease-out, var(--anim-ease-out));
		color: var(--color-primary);
	}

	.card:hover .card-link::after,
	[data-card]:hover .card-link::after {
		opacity: 1;
		transform: var(--card-link-transform);
	}

	/* Card alignment */
	.card-centered,
	[data-card][data-centered] {
		text-align: center;

		& .card-title,
		& .card-subtitle,
		& .card-text,
		& [data-card-title],
		& [data-card-subtitle],
		& [data-card-text] {
			text-align: center;
		}
	}

	/* ============================================
	   Entity-Specific Styles
	   ============================================ */

	.entity-list-item {
		padding: 0;
		list-style: none;
		margin-bottom: var(--spacing-6);
	}

	.entity-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: var(--spacing-4);
	}

	@container card (min-width: 400px) {
		.entity-grid {
			grid-template-columns: auto 1fr;
		}
	}

	.entity-image-container {
		display: flex;
		justify-content: center;
	}

	@container card (min-width: 400px) {
		.entity-image-container {
			justify-content: flex-start;
		}
	}

	.entity-cover-image {
		width: 100%;
		max-width: 200px;
		height: auto;
		aspect-ratio: 5/7;
		object-fit: cover;
		border-radius: var(--border-radius);
		box-shadow: var(--shadow-md);
		transition: box-shadow var(--motion-duration-normal, var(--anim-duration-base)) var(--motion-ease-out, var(--anim-ease-out));
	}

	.entity-card:hover .entity-cover-image,
	[data-card][data-variant='entity']:hover .entity-cover-image {
		box-shadow: var(--shadow-lg);
	}

	.entity-content {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-2);
	}

	.entity-meta {
		display: flex;
		align-items: center;
		gap: var(--spacing-2);
		margin-bottom: var(--spacing-1);
	}

	.entity-type {
		color: var(--color-primary);
		font-size: var(--font-size-sm);
		font-weight: var(--font-weight-medium);
	}

	.entity-language {
		color: var(--color-text-muted);
		font-size: var(--font-size-sm);
	}

	.entity-title {
		font-size: var(--font-size-xl);
		font-weight: var(--font-weight-medium);
		margin-bottom: var(--spacing-2);
		color: var(--color-text-emphasis);
		line-height: var(--line-height-snug);
	}

	.entity-title-link {
		color: inherit;
		text-decoration: none;
		transition: color var(--motion-duration-fast, var(--anim-duration-fast)) var(--motion-ease-out, var(--anim-ease-out));
	}

	.entity-title-link:hover {
		color: var(--color-primary);
	}

	.entity-details,
	.entity-abstract {
		color: var(--color-text-light);
		font-size: var(--font-size-sm);
		margin-bottom: var(--spacing-2);
		line-height: var(--line-height-relaxed);
	}

	.entity-abstract {
		margin-bottom: var(--spacing-4);
	}

	.entity-tags {
		margin-top: var(--spacing-3);
	}

	.entity-tags :global(.tag-list) {
		display: flex;
		flex-wrap: wrap;
		gap: var(--spacing-2);
	}

	.entity-links {
		margin-top: var(--spacing-3);
		display: flex;
		flex-wrap: wrap;
		gap: var(--spacing-2);
	}

	.entity-link-btn {
		font-size: var(--font-size-sm);
		padding: var(--spacing-2) var(--spacing-3);
		border-radius: var(--border-radius);
		text-decoration: none;
		font-weight: var(--font-weight-medium);
		transition: all var(--motion-duration-normal, var(--anim-duration-base)) var(--motion-ease-standard, var(--anim-ease-base));
	}

	.entity-link-btn:after {
		content: 'â†—';
		font-size: var(--font-size-xs);
		margin-left: var(--spacing-1);
		opacity: var(--opacity-high, 0.9);
	}

	/* ============================================
	   Card Grid System
	   ============================================ */

	.card-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: var(--spacing-6);
	}

	@media (--mq-sm) {
		.card-grid {
			grid-template-columns: repeat(2, 1fr);
		}
	}

	@media (--mq-lg) {
		.card-grid {
			grid-template-columns: repeat(3, 1fr);
		}
	}

	/* Card spacing modifiers */
	.card-spacing-sm {
		margin-bottom: var(--spacing-4);
	}

	.card-spacing-md {
		margin-bottom: var(--spacing-6);
	}

	.card-spacing-lg {
		margin-bottom: var(--spacing-8);
	}

	/* ============================================
	   Dark Mode Overrides
	   ============================================ */

	:global(html.dark) .card,
	:global(html.dark) [data-card] {
		background: linear-gradient(
			135deg,
			rgba(var(--color-primary-rgb), 0.06) 0%,
			rgba(var(--color-highlight-rgb), 0.04) 50%,
			rgba(var(--color-accent-rgb), 0.02) 100%
		);
		border: var(--border-width-thin) solid
			rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-border-dark));
		box-shadow:
			0 var(--spacing-2) var(--spacing-8) 0
				rgba(var(--color-text-rgb, 0, 0, 0), var(--opacity-medium-high)),
			inset 0 var(--border-width-thin) 0
				rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-inset-dark));
	}

	:global(html.dark) .card:hover,
	:global(html.dark) [data-card]:hover {
		background: linear-gradient(
			135deg,
			rgba(var(--color-primary-rgb), 0.08) 0%,
			rgba(var(--color-highlight-rgb), 0.06) 50%,
			rgba(var(--color-accent-rgb), 0.04) 100%
		);
		border-color: rgba(
			var(--color-background-rgb, 255, 255, 255),
			var(--card-glass-border-dark-hover)
		);
		box-shadow:
			0 var(--spacing-3) var(--spacing-10) 0 rgba(var(--color-text-rgb, 0, 0, 0), var(--opacity-high)),
			inset 0 var(--border-width-thin) 0
				rgba(var(--color-background-rgb, 255, 255, 255), var(--card-glass-inset-dark-hover));
	}

	:global(html.dark) .card[data-variant='glass'],
	:global(html.dark) [data-card][data-variant='glass'] {
		background: rgba(var(--color-text-rgb, 0, 0, 0), var(--card-glass-opacity-dark));
		border-color: rgba(
			var(--color-background-rgb, 255, 255, 255),
			var(--card-glass-border-dark)
		);
	}

	/* Fallback for browsers without backdrop-filter */
	@supports not (backdrop-filter: blur(10px)) {
		.card,
		[data-card] {
			background: rgba(255, 255, 255, 0.9);
		}

		:global(html.dark) .card,
		:global(html.dark) [data-card] {
			background: rgba(0, 0, 0, 0.8);
		}
	}

	/* ============================================
	   Accessibility & Motion Preferences
	   ============================================ */

	@media (--prefers-reduced-motion) {
		.card,
		[data-card],
		.card-image img,
		[data-card-image] img,
		.entity-card,
		.entity-cover-image,
		.entity-link-btn {
			transition: none;
		}

		.card:hover,
		[data-card]:hover,
		.entity-card:hover {
			transform: none;
		}

		.card:hover .card-image img,
		[data-card]:hover [data-card-image] img {
			transform: none;
		}
	}

	/* High contrast mode support */
	@media (prefers-contrast: high) {
		.card,
		[data-card] {
			border-width: var(--border-width-base);
		}
	}

	/* Responsive adjustments for small screens */
	@media (--mq-sm-down) {
		.card,
		[data-card],
		.entity-card {
			& [data-card-body],
			& .card-body {
				padding: var(--spacing-4);
			}

			& [data-card-title],
			& .card-title,
			& .entity-title {
				font-size: var(--font-size-lg);
			}
		}

		.entity-cover-image {
			max-width: 150px;
		}
	}

} /* End @layer components */
