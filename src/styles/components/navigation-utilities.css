/**
 * Shared Navigation Utilities
 * This file contains shared utilities and patterns used across navigation components
 * Part of CSS Refactor Phase 3.3
 */

@layer components {
	/* ==========================================================================
	   Accessibility Utilities
	   ========================================================================== */

	/* Screen reader only utility - hides content visually but keeps it accessible */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}

	/* Screen reader only utility that's focusable for skip links */
	.sr-only-focusable:not(:focus):not(:focus-within) {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}

	/* ==========================================================================
	   Focus Management
	   ========================================================================== */

	/* Enhanced focus visible utility for all interactive elements */
	*:focus-visible {
		outline: var(--border-width-medium) solid var(--color-primary);
		outline-offset: var(--spacing-1);
		border-radius: var(--border-radius-sm);
		transition:
			outline-color var(--motion-duration-fast) var(--motion-ease-out),
			outline-offset var(--motion-duration-fast) var(--motion-ease-out);
	}

	/* Keyboard focus ring for navigation links */
	[data-nav-link]:focus-visible,
	.nav-link:focus-visible {
		outline: var(--border-width-medium) solid var(--color-primary);
		outline-offset: var(--spacing-2);
		border-radius: var(--border-radius-sm);
	}

	/* Button focus states */
	[data-nav-button]:focus-visible,
	.nav-button:focus-visible {
		outline: var(--border-width-medium) solid var(--color-primary);
		outline-offset: var(--spacing-1);
		border-radius: var(--border-radius-md);
	}

	/* Skip to main content link */
	.skip-link {
		position: absolute;
		top: var(--spacing-2);
		left: var(--spacing-2);
		z-index: 1000;
		padding: var(--spacing-2) var(--spacing-4);
		background: var(--color-surface);
		color: var(--color-text);
		text-decoration: none;
		border-radius: var(--border-radius-md);
		font-weight: 600;
		box-shadow: var(--shadow-lg);
		transform: translateY(-120%);
		transition: transform var(--motion-duration-normal) var(--motion-ease-out);
	}

	.skip-link:focus {
		transform: translateY(0);
	}

	/* ==========================================================================
	   Responsive Navigation Patterns
	   ========================================================================== */

	/* Mobile-first navigation container */
	[data-nav-container],
	.nav-container {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-2);
	}

	/* Desktop horizontal navigation */
	@media (--mq-lg) {
		[data-nav-container],
		.nav-container {
			flex-direction: row;
			align-items: center;
			gap: var(--spacing-6);
		}
	}

	/* Hide mobile menu on desktop */
	@media (--mq-lg) {
		[data-mobile-menu],
		.mobile-menu {
			display: none;
		}
	}

	/* Hide desktop nav on mobile */
	@media (--mq-md-down) {
		[data-desktop-nav],
		.desktop-nav {
			display: none;
		}
	}

	/* ==========================================================================
	   Motion & Animation
	   ========================================================================== */

	/* Base navigation transitions - use design tokens */
	[data-nav-link],
	.nav-link {
		transition:
			color var(--motion-duration-fast) var(--motion-ease-out),
			background-color var(--motion-duration-fast) var(--motion-ease-out),
			transform var(--motion-duration-fast) var(--motion-ease-out);
	}

	/* Dropdown animations */
	[data-dropdown],
	.dropdown-menu {
		transition:
			opacity var(--motion-duration-normal) var(--motion-ease-out),
			transform var(--motion-duration-normal) var(--motion-ease-out),
			visibility var(--motion-duration-normal) step-end;
	}

	[data-dropdown][data-active='true'],
	.dropdown-menu.active {
		transition:
			opacity var(--motion-duration-normal) var(--motion-ease-out),
			transform var(--motion-duration-normal) var(--motion-ease-out),
			visibility var(--motion-duration-normal) step-start;
	}

	/* Hamburger button animations */
	[data-hamburger] span {
		transition:
			transform var(--motion-duration-normal) var(--motion-ease-out),
			opacity var(--motion-duration-fast) var(--motion-ease-out);
	}

	/* Reduced motion support for all navigation elements */
	@media (--prefers-reduced-motion) {
		*,
		[data-nav-link],
		[data-dropdown],
		[data-hamburger] span,
		.nav-link,
		.dropdown-menu,
		.skip-link {
			animation-duration: 0.01ms !important;
			animation-iteration-count: 1 !important;
			transition-duration: 0.01ms !important;
		}
	}

	/* ==========================================================================
	   High Contrast Mode Support
	   ========================================================================== */

	@media (--prefers-high-contrast) {
		/* Enhanced borders and outlines for better visibility */
		*:focus-visible,
		[data-nav-link]:focus-visible,
		.nav-link:focus-visible {
			outline-width: var(--border-width-thick);
		}

		/* Stronger hover indicators */
		[data-nav-link]:hover,
		.nav-link:hover {
			text-decoration: underline;
			text-decoration-thickness: var(--border-width-medium);
		}

		/* Enhanced dropdown borders */
		[data-dropdown],
		.dropdown-menu {
			border: var(--border-width-medium) solid currentColor;
		}
	}

	/* ==========================================================================
	   Touch Device Optimization
	   ========================================================================== */

	/* Larger tap targets on touch devices */
	@media (hover: none) {
		[data-nav-link],
		[data-nav-button],
		.nav-link,
		.nav-button {
			min-height: 44px; /* iOS accessibility guideline */
			padding-block: var(--spacing-3);
		}
	}

	/* ==========================================================================
	   Glassmorphism Navigation Pattern
	   ========================================================================== */

	/* Shared glassmorphism style for navigation components */
	[data-nav-glass],
	.nav-glass {
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.8) 0%,
			rgba(var(--color-primary-rgb), 0.02) 50%,
			rgba(var(--color-highlight-rgb), 0.01) 100%
		);
		-webkit-backdrop-filter: blur(20px);
		backdrop-filter: blur(20px);
		border-bottom: var(--border-width-thin) solid rgba(255, 255, 255, 0.3);
		box-shadow:
			0 4px 24px 0 rgba(31, 38, 135, 0.15),
			inset 0 1px 0 rgba(255, 255, 255, 0.4);
		transition:
			background var(--motion-duration-normal) var(--motion-ease-out),
			border-color var(--motion-duration-normal) var(--motion-ease-out),
			box-shadow var(--motion-duration-normal) var(--motion-ease-out);
	}

	[data-nav-glass]:hover,
	.nav-glass:hover {
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.9) 0%,
			rgba(var(--color-primary-rgb), 0.03) 50%,
			rgba(var(--color-highlight-rgb), 0.02) 100%
		);
		border-bottom-color: rgba(255, 255, 255, 0.4);
		box-shadow:
			0 6px 32px 0 rgba(31, 38, 135, 0.2),
			inset 0 1px 0 rgba(255, 255, 255, 0.5);
	}

	/* Dark mode glassmorphism */
	:global(html.dark) [data-nav-glass],
	:global(html.dark) .nav-glass {
		background: linear-gradient(
			135deg,
			rgba(var(--color-dark-surface-rgb), 0.8) 0%,
			rgba(var(--color-primary-rgb), 0.04) 50%,
			rgba(var(--color-highlight-rgb), 0.02) 100%
		);
		border-bottom: var(--border-width-thin) solid rgba(255, 255, 255, 0.15);
		box-shadow:
			0 4px 24px 0 rgba(0, 0, 0, 0.4),
			inset 0 1px 0 rgba(255, 255, 255, 0.1);
	}

	:global(html.dark) [data-nav-glass]:hover,
	:global(html.dark) .nav-glass:hover {
		background: linear-gradient(
			135deg,
			rgba(var(--color-dark-surface-rgb), 0.85) 0%,
			rgba(var(--color-primary-rgb), 0.06) 50%,
			rgba(var(--color-highlight-rgb), 0.03) 100%
		);
		border-bottom-color: rgba(255, 255, 255, 0.2);
		box-shadow:
			0 6px 32px 0 rgba(0, 0, 0, 0.5),
			inset 0 1px 0 rgba(255, 255, 255, 0.15);
	}

	/* ==========================================================================
	   Performance Optimizations
	   ========================================================================== */

	/* CSS containment for navigation components */
	[data-nav-container],
	.nav-container {
		contain: layout style;
	}

	/* GPU acceleration for dropdowns */
	[data-dropdown],
	.dropdown-menu {
		will-change: opacity, transform;
	}

	[data-dropdown]:not([data-active='true']),
	.dropdown-menu:not(.active) {
		will-change: auto;
	}

	/* Optimize font rendering */
	[data-nav-link],
	.nav-link {
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
	}
}
